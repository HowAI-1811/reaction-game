<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reflex 3D | Reaction Timer</title>
    <link rel="icon" type="image/x-icon" href="howai.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Configuration & Custom Styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#0F172A',
                        surface: '#1E293B',
                        primary: '#F1F5F9',
                        secondary: '#94A3B8',
                        ready: '#10B981',   // Emerald
                        waiting: '#F59E0B', // Amber
                        result: '#3B82F6',  // Blue
                        error: '#EF4444',   // Red
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0F172A;
            color: #F1F5F9;
            overflow: hidden; /* Prevent scroll on touch devices */
            touch-action: manipulation;
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* Let clicks pass through to click-zone */
        }

        /* Interactive Zone covers the screen but sits below buttons */
        #click-zone {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            cursor: pointer;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>

    <!-- Invisible Full Screen Click Area -->
    <div id="click-zone"></div>

    <!-- UI Overlay -->
    <div id="ui-layer" class="flex flex-col justify-between p-6 h-full">
        
        <!-- Header -->
        <header class="flex justify-between items-start pointer-events-auto">
            <div>
                <h1 class="font-display text-3xl md:text-4xl font-bold tracking-tight text-white mb-1">REFLEX<span class="text-result">3D</span></h1>
                <p class="text-secondary text-sm font-light tracking-wide uppercase">Reaction Competence Test</p>
            </div>
            <button id="reset-btn" class="glass-panel px-4 py-2 rounded-lg text-xs font-semibold hover:bg-white/10 transition-colors text-secondary hover:text-white uppercase tracking-wider">
                Reset Stats
            </button>
        </header>

        <!-- Main Status Display (Centered) -->
        <main class="flex-grow flex flex-col justify-center items-center text-center pointer-events-none">
            <div id="status-container" class="animate-pop">
                <h2 id="main-status" class="font-display text-5xl md:text-7xl font-bold text-white mb-2 drop-shadow-xl">
                    START
                </h2>
                <p id="sub-status" class="text-lg md:text-xl text-secondary font-medium">
                    Tap anywhere to begin
                </p>
            </div>
            
            <!-- Result Display (Hidden by default) -->
            <div id="result-display" class="hidden animate-pop mt-4">
                <div class="font-mono text-6xl md:text-8xl font-bold text-white tracking-tighter">
                    <span id="time-value">0</span><span class="text-2xl md:text-4xl text-secondary ml-1">ms</span>
                </div>
                <div id="result-feedback" class="mt-2 text-result font-semibold uppercase tracking-widest text-sm">
                    Excellent Reflexes
                </div>
            </div>
        </main>

        <!-- Footer / Stats -->
        <footer class="pointer-events-auto">
            <div class="glass-panel rounded-2xl p-4 md:p-6 grid grid-cols-3 gap-4 max-w-2xl mx-auto shadow-2xl">
                <div class="text-center border-r border-white/5">
                    <div class="text-secondary text-xs uppercase font-bold tracking-wider mb-1">Average</div>
                    <div class="font-mono text-xl md:text-2xl font-bold text-white"><span id="stat-avg">--</span></div>
                </div>
                <div class="text-center border-r border-white/5">
                    <div class="text-secondary text-xs uppercase font-bold tracking-wider mb-1">Best</div>
                    <div class="font-mono text-xl md:text-2xl font-bold text-ready"><span id="stat-best">--</span></div>
                </div>
                <div class="text-center">
                    <div class="text-secondary text-xs uppercase font-bold tracking-wider mb-1">Attempts</div>
                    <div class="font-mono text-xl md:text-2xl font-bold text-white"><span id="stat-count">0</span></div>
                </div>
            </div>
            <div class="text-center mt-4 text-xs text-secondary/50 font-mono">
                v1.0.0 • THREE.JS • PERFORMANCE.NOW()
            </div>
        </footer>
    </div>

    <script>
        /**
         * Game Configuration & State
         */
        const CONFIG = {
            minDelay: 1000, // ms
            maxDelay: 5000, // ms
            colors: {
                idle: 0x94A3B8,    // Slate 400
                waiting: 0xF59E0B, // Amber 500
                ready: 0x10B981,   // Emerald 500
                early: 0xEF4444,   // Red 500
                result: 0x3B82F6   // Blue 500
            }
        };

        const STATE = {
            IDLE: 'IDLE',       // Game hasn't started or was reset
            WAITING: 'WAITING', // User clicked start, waiting for green
            READY: 'READY',     // Green light, timer running
            RESULT: 'RESULT',   // User clicked, showing time
            EARLY: 'EARLY'      // User clicked too soon
        };

        let currentState = STATE.IDLE;
        let timerStart = 0;
        let waitingTimeout = null;
        
        let stats = {
            attempts: [],
            best: Infinity
        };

        /**
         * 3D Scene Setup (Three.js)
         */
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Add subtle fog for depth
        scene.fog = new THREE.FogExp2(0x0F172A, 0.035);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Optimize for high DPI
        container.appendChild(renderer.domElement);

        // -- Lighting --
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        const backLight = new THREE.DirectionalLight(0xffffff, 0.5);
        backLight.position.set(-5, -5, -10);
        scene.add(backLight);

        // -- Objects --
        const geometry = new THREE.IcosahedronGeometry(1.8, 0); // Low poly look
        const material = new THREE.MeshStandardMaterial({ 
            color: CONFIG.colors.idle,
            roughness: 0.2,
            metalness: 0.8,
            flatShading: true,
            emissive: CONFIG.colors.idle,
            emissiveIntensity: 0.2
        });
        const mainObject = new THREE.Mesh(geometry, material);
        scene.add(mainObject);

        // Wireframe shell
        const wireGeo = new THREE.IcosahedronGeometry(2.2, 1);
        const wireMat = new THREE.MeshBasicMaterial({ 
            color: 0xffffff, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.05 
        });
        const wireMesh = new THREE.Mesh(wireGeo, wireMat);
        scene.add(wireMesh);

        // Particle System (Background stars)
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 700;
        const posArray = new Float32Array(particlesCount * 3);
        
        for(let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 40; // Spread
        }
        
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.03,
            color: 0x64748B,
            transparent: true,
            opacity: 0.4
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        /**
         * UI Elements
         */
        const elMainStatus = document.getElementById('main-status');
        const elSubStatus = document.getElementById('sub-status');
        const elStatusContainer = document.getElementById('status-container');
        const elResultDisplay = document.getElementById('result-display');
        const elTimeValue = document.getElementById('time-value');
        const elClickZone = document.getElementById('click-zone');
        const elResetBtn = document.getElementById('reset-btn');
        const elResultFeedback = document.getElementById('result-feedback');

        // Stats Elements
        const elStatAvg = document.getElementById('stat-avg');
        const elStatBest = document.getElementById('stat-best');
        const elStatCount = document.getElementById('stat-count');

        /**
         * Game Logic
         */

        function setVisualState(state) {
            // Update 3D Object Color
            let targetColor = CONFIG.colors.idle;
            let intensity = 0.2;
            let scale = 1;

            switch(state) {
                case STATE.IDLE: 
                    targetColor = CONFIG.colors.idle; 
                    break;
                case STATE.WAITING: 
                    targetColor = CONFIG.colors.waiting; 
                    intensity = 0.5;
                    break;
                case STATE.READY: 
                    targetColor = CONFIG.colors.ready; 
                    intensity = 1.2; // Glow bright
                    scale = 1.2;
                    break;
                case STATE.EARLY: 
                    targetColor = CONFIG.colors.early; 
                    intensity = 0.8;
                    break;
                case STATE.RESULT: 
                    targetColor = CONFIG.colors.result; 
                    break;
            }

            // Animate Color Transition
            new TWEEN_Color(material.color, targetColor, 200);
            new TWEEN_Color(material.emissive, targetColor, 200);
            material.emissiveIntensity = intensity;
            
            // Subtle scale effect
            mainObject.scale.set(scale, scale, scale);
        }

        function updateUI(state, extraData = null) {
            elStatusContainer.style.display = 'block';
            elResultDisplay.classList.add('hidden');
            
            // Reset text colors
            elMainStatus.className = "font-display text-5xl md:text-7xl font-bold mb-2 drop-shadow-xl transition-colors duration-300";

            switch(state) {
                case STATE.IDLE:
                    elMainStatus.textContent = "START";
                    elMainStatus.classList.add("text-white");
                    elSubStatus.textContent = "Click anywhere to begin";
                    break;
                case STATE.WAITING:
                    elMainStatus.textContent = "WAIT";
                    elMainStatus.classList.add("text-waiting");
                    elSubStatus.textContent = "Wait for green...";
                    break;
                case STATE.READY:
                    elMainStatus.textContent = "CLICK!";
                    elMainStatus.classList.add("text-ready");
                    elSubStatus.textContent = "GO GO GO!";
                    break;
                case STATE.EARLY:
                    elMainStatus.textContent = "TOO SOON";
                    elMainStatus.classList.add("text-error");
                    elSubStatus.textContent = "Click to try again";
                    break;
                case STATE.RESULT:
                    elStatusContainer.style.display = 'none';
                    elResultDisplay.classList.remove('hidden');
                    elTimeValue.textContent = extraData;
                    
                    // Feedback text
                    let feedback = "Good Job";
                    if(extraData < 200) feedback = "Godlike Reflexes!";
                    else if(extraData < 250) feedback = "Excellent!";
                    else if(extraData < 350) feedback = "Average";
                    else feedback = "Too Slow";
                    
                    elResultFeedback.textContent = feedback;
                    elResultFeedback.style.color = state === STATE.RESULT ? '#3B82F6' : '#fff';
                    break;
            }
        }

        function handleInteraction(e) {
            e.preventDefault(); // Prevent double firing on touch devices

            if (currentState === STATE.IDLE || currentState === STATE.RESULT) {
                startWaiting();
            } else if (currentState === STATE.EARLY) {
                // Return to IDLE/WAITING from error
                startWaiting();
            } else if (currentState === STATE.WAITING) {
                triggerTooEarly();
            } else if (currentState === STATE.READY) {
                const reactionTime = performance.now() - timerStart;
                triggerResult(reactionTime);
            }
        }

        function startWaiting() {
            currentState = STATE.WAITING;
            setVisualState(STATE.WAITING);
            updateUI(STATE.WAITING);

            const randomDelay = Math.floor(Math.random() * (CONFIG.maxDelay - CONFIG.minDelay + 1)) + CONFIG.minDelay;

            if (waitingTimeout) clearTimeout(waitingTimeout);
            waitingTimeout = setTimeout(() => {
                triggerReady();
            }, randomDelay);
        }

        function triggerReady() {
            if (currentState !== STATE.WAITING) return;
            
            currentState = STATE.READY;
            timerStart = performance.now();
            setVisualState(STATE.READY);
            updateUI(STATE.READY);
        }

        function triggerTooEarly() {
            currentState = STATE.EARLY;
            if (waitingTimeout) clearTimeout(waitingTimeout);
            setVisualState(STATE.EARLY);
            updateUI(STATE.EARLY);
            
            // Screen shake effect in 3D
            shakeCamera();
        }

        function triggerResult(time) {
            currentState = STATE.RESULT;
            const formattedTime = Math.floor(time);
            
            setVisualState(STATE.RESULT);
            updateUI(STATE.RESULT, formattedTime);
            updateStats(formattedTime);
        }

        function updateStats(newTime) {
            stats.attempts.push(newTime);
            
            // Update Best
            if (newTime < stats.best) {
                stats.best = newTime;
                elStatBest.textContent = newTime + 'ms';
            }

            // Update Avg
            const sum = stats.attempts.reduce((a, b) => a + b, 0);
            const avg = Math.floor(sum / stats.attempts.length);
            elStatAvg.textContent = avg + 'ms';

            // Update Count
            elStatCount.textContent = stats.attempts.length;
        }

        function resetGame() {
            if (waitingTimeout) clearTimeout(waitingTimeout);
            currentState = STATE.IDLE;
            stats = { attempts: [], best: Infinity };
            
            elStatAvg.textContent = '--';
            elStatBest.textContent = '--';
            elStatCount.textContent = '0';
            
            setVisualState(STATE.IDLE);
            updateUI(STATE.IDLE);
        }

        // Camera Shake Effect
        let shakeIntensity = 0;
        function shakeCamera() {
            shakeIntensity = 0.5;
        }

        /**
         * Helper: Simple Color Tweening (Lerp)
         */
        class TWEEN_Color {
            constructor(targetColorObj, hexDestination, duration) {
                this.target = targetColorObj;
                this.start = targetColorObj.getHex();
                this.end = new THREE.Color(hexDestination).getHex();
                this.startTime = performance.now();
                this.duration = duration;
                
                // Add to global animation queue logic (simplified here within update loop)
                this.active = true;
                activeTweens.push(this);
            }
            
            update(now) {
                const elapsed = now - this.startTime;
                const progress = Math.min(elapsed / this.duration, 1);
                
                const c1 = new THREE.Color(this.start);
                const c2 = new THREE.Color(this.end);
                
                this.target.lerpColors(c1, c2, progress);
                
                if (progress >= 1) this.active = false;
            }
        }
        let activeTweens = [];

        /**
         * Animation Loop
         */
        function animate() {
            requestAnimationFrame(animate);

            const now = performance.now();
            const timeSeconds = now * 0.001;

            // Handle Color Tweens
            activeTweens = activeTweens.filter(t => t.active);
            activeTweens.forEach(t => t.update(now));

            // Rotate Main Object based on state
            if (currentState === STATE.WAITING) {
                // Nervous slow wobble
                mainObject.rotation.x = Math.sin(timeSeconds * 2) * 0.2;
                mainObject.rotation.y += 0.02;
            } else if (currentState === STATE.READY) {
                // High speed spin
                mainObject.rotation.x += 0.1;
                mainObject.rotation.y += 0.1;
            } else if (currentState === STATE.IDLE) {
                // Gentle float
                mainObject.rotation.x = Math.sin(timeSeconds * 0.5) * 0.1;
                mainObject.rotation.y += 0.005;
            } else {
                // Standard spin
                mainObject.rotation.y += 0.01;
            }

            // Wireframe follows but slower/offset
            wireMesh.rotation.copy(mainObject.rotation);
            wireMesh.rotation.z -= 0.01;

            // Particles rotation
            particlesMesh.rotation.y = timeSeconds * 0.05;

            // Camera Shake logic
            if (shakeIntensity > 0) {
                camera.position.x = (Math.random() - 0.5) * shakeIntensity;
                camera.position.y = (Math.random() - 0.5) * shakeIntensity;
                shakeIntensity *= 0.9; // Decay
                if(shakeIntensity < 0.01) {
                    shakeIntensity = 0;
                    camera.position.set(0, 0, 5); // Reset
                }
            }

            renderer.render(scene, camera);
        }

        /**
         * Event Listeners
         */
        elClickZone.addEventListener('mousedown', handleInteraction);
        elClickZone.addEventListener('touchstart', handleInteraction, {passive: false});
        
        elResetBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Don't trigger game click
            resetGame();
        });

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initial Start
        animate();
        updateUI(STATE.IDLE);

    </script>
</body>
</html>
